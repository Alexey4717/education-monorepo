# Общие сведения

Монорепозиторий — это набор множества различных приложений и пакетов в единой кодовой базе.

Основным строительным блоком монорепозитория является рабочее пространство (workspace).
Каждое приложение и пакет будут находиться в своем собственном рабочем пространстве, со своим собственным package.json

рабочие пространства могут зависеть друг от друга

```json
{
  "dependencies": {
    "shared-utils": "*"
  }
}
```

## Корневой workspace

Есть корневое рабочее пространство в корневой папке кодовой базы с package.json.
Это полезное место для:

- Указание зависимостей, которые присутствуют во всем монорепозитории
- Добавление задач, которые работают со всем монорепозиторием, а не только с отдельными рабочими областями
- Добавление документации по использованию монорепозитория

## Управление монорепой

Управление монорепой происходит через Turbo.
В каждой apps находится свой package.json, но node_modules хранится в корне монорепы (в дочерних пакетах/приложениях node_modules со ссылками на корневой).

Это достигается за счёт использования workspaces, которые:
- "видят" все package.json в подпапках (apps/*, packages/*),
- собирают ВСЕ зависимости в один общий node_modules в корне,
- но понимают, кто и какие зависимости реально использует,
- Если обе app используют одну и ту же либу, она будет установлена один раз на весь проект, без дублирования.

Это экономит место и ускоряет установку 

## Структура монорепозитория

```editorconfig
my-monorepo/
├── apps/
│   ├── web/               # Next.js (порт 3000)
│   │   ├── next.config.js # rewrites для API
│   │   └── tsconfig.json
│   └── server/            # Express (порт 3001)
├── packages/
│   └── shared/            # Общие типы/утилиты
├── .eslintrc.js           # Общий ESLint
├── .prettierrc            # Общий Prettier
├── tsconfig.base.json     # Базовый TypeScript
└── turbo.json             # Управление задачами
```

## Установка зависимостей.

1. Если зависимости нужны только для одного workspace (например, apps/web)
   Перейдите в папку проекта и установите их там
2. Если зависимости нужны глобально (в корень монорепозитория)
   Используйте флаг -W (или --ignore-workspace-root-check)

### Почему так происходит?

Yarn 1.x по умолчанию ожидает, что зависимости добавляются в конкретные workspaces, а не в корень.
Если зависимости нужны для общей конфигурации (ESLint, Prettier, TypeScript), их лучше установить в корень.
Если зависимости нужны только для одного проекта (например, next для apps/web), их нужно ставить локально.

### Общие правила:

- В корень (-W) → инструменты сборки, линтинга, тестирования и общие dev-зависимости (typescript, eslint, prettier, jest и т. д.).
- Локально → зависимости, специфичные для проекта (например, next, express, react, mongodb).

## Именование workspaces

Каждое рабочее пространство имеет уникальное имя, которое указывается в его package.json

```json
{
  "name": "shared-utils"
}
```